<!DOCTYPE html>
<html lang="en" color-mode="light">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="owenqing" />
  <!-- Open Graph Description ç®€çŸ­æ‘˜è¦-->
  
      <!-- ç”¨äºæœç´¢å¼•æ“çš„æ–‡ç« æ‘˜è¦ -->
      
            
                
                  <title>
                    
                      ç®€æ´çš„æ¶æ„
                        
                              
                                    |
                                    
                                      owenqing
                  </title>

                  
                    <link rel="apple-touch-icon" href="/images/ai.jpg">
                    <link rel="icon" href="/images/ai.jpg">
                    

                      <!-- Noto Sans SC for harmonious CJK/Latin mixing -->
                      <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500&display=swap"
                        rel="stylesheet">
                      <!-- Raleway-Font (kept for legacy) -->
                      <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

                      <!-- hexo site css -->
                      <link rel="stylesheet" href="/css/main.css" />
                      <link rel="stylesheet" href="/css/zen.css?v=1760457787798" />
                      <link rel="stylesheet" href="/css/typography-fix.css" />
                      <link rel="stylesheet" href="/css/code-block-enhanced.css" />
                      <link rel="stylesheet" href="/css/mobile-nav.css" />
                      <link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css" />
                      <!-- ä»£ç å—é£æ ¼ -->
                      

                            <!-- jquery3.3.1 -->
                            
                                <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
                                

                                  <!-- fancybox -->
                                  
                                      <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
                                      <script defer type="text/javascript"
                                        src="/plugins/jquery.fancybox.min.js"></script>
                                      
                                        
<script src="/js/fancybox.js"></script>


                                          

                                              

                                                  <script>
                                                    var html = document.documentElement
                                                    const colorMode = localStorage.getItem('color-mode')
                                                    if (colorMode) {
                                                      document.documentElement.setAttribute('color-mode', colorMode)
                                                    }
                                                  </script>

                                                  <link rel="stylesheet" href="/css/code-fix.css">
                                                  <link rel="stylesheet" href="/css/code-block-fix.css">
                                                  <link rel="stylesheet" href="/css/code-border-fix.css">

                                                  <!-- æ·»åŠ headeræ•ˆæœè„šæœ¬ -->
                                                  <!-- <script defer type="text/javascript" src="/js/headerEffect.js"></script> -->

                                                  <link rel="stylesheet" href="/css/header-fix.css">
<meta name="generator" content="Hexo 7.3.0"></head>

  <body>
    <div id="app">
      <div class="header"
  style="position:fixed !important; top:0 !important; left:0 !important; right:0 !important; width:100% !important;">
  <div class="navbar">
    <nav class="navbar">
      <a href="/" class="blog-title">
        <span class="outer-orbit"></span>
        <span class="electron"></span>
        <span class="electron-yellow"></span>
        owenqing posts
      </a>

      <!-- Mobile menu toggle button -->
      <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <span class="hamburger"></span>
        <span class="hamburger"></span>
        <span class="hamburger"></span>
        <span class="toggle-text">Menu</span>
      </button>

      <ul class="nav-menu">
        
          
            <li class="active">
              <a href="/">
                
                    Home
              </a>
            </li>
            
              
          
              
          
              
          
            <li class="">
              <a href="/tags/">
                
                    Tags
              </a>
            </li>
            
              
          
            <li class="">
              <a href="/friends/">
                
                    Friends
              </a>
            </li>
            
              
          
            <li class="">
              <a href="/about/">
                
                    About
              </a>
            </li>
            
              
      </ul>
    </nav>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');
    const toggleText = document.querySelector('.toggle-text');
    const headerEl = document.querySelector('.header');
    const isPostPage = document.querySelector('.post-details') !== null;
    if (headerEl && isPostPage) {
      headerEl.classList.add('on-post');
    }

    if (navToggle && navMenu) {
      navToggle.addEventListener('click', function (e) {
        e.stopPropagation();
        navMenu.classList.toggle('nav-menu-active');
        const isOpen = navMenu.classList.contains('nav-menu-active');
        navToggle.setAttribute('aria-expanded', isOpen);
        toggleText.textContent = isOpen ? 'Close' : 'Menu';
        navToggle.classList.toggle('active', isOpen);

        // Prevent body scroll when menu is open
        if (isOpen) {
          document.body.classList.add('hidden');
        } else {
          document.body.classList.remove('hidden');
        }
      });

      // Close menu when clicking outside
      document.addEventListener('click', function (e) {
        if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
          navMenu.classList.remove('nav-menu-active');
          navToggle.setAttribute('aria-expanded', 'false');
          toggleText.textContent = 'Menu';
          navToggle.classList.remove('active');
          document.body.classList.remove('hidden');
        }
      });

      // Close menu when clicking on a nav link
      const navLinks = document.querySelectorAll('.nav-menu a');
      navLinks.forEach(link => {
        link.addEventListener('click', function () {
          navMenu.classList.remove('nav-menu-active');
          navToggle.setAttribute('aria-expanded', 'false');
          toggleText.textContent = 'Menu';
          navToggle.classList.remove('active');
          document.body.classList.remove('hidden');
        });
      });

      // Close menu on ESC key
      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && navMenu.classList.contains('nav-menu-active')) {
          navMenu.classList.remove('nav-menu-active');
          navToggle.setAttribute('aria-expanded', 'false');
          toggleText.textContent = 'Menu';
          navToggle.classList.remove('active');
          document.body.classList.remove('hidden');
        }
      });

      // Handle window resize
      window.addEventListener('resize', function () {
        if (window.innerWidth > 768) {
          navMenu.classList.remove('nav-menu-active');
          navToggle.setAttribute('aria-expanded', 'false');
          toggleText.textContent = 'Menu';
          navToggle.classList.remove('active');
          document.body.classList.remove('hidden');
        }
      });
    }
  });
</script>

        <div class="flex-container">
          <!-- æ–‡ç« è¯¦æƒ…é¡µï¼Œå±•ç¤ºæ–‡ç« å…·ä½“å†…å®¹ï¼Œurlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
<!-- åŒæ—¶ä¸ºã€Œæ ‡ç­¾tagã€ï¼Œã€Œæœ‹å‹friendã€ï¼Œã€Œåˆ†ç±»categoriesã€ï¼Œã€Œå…³äºaboutã€é¡µé¢çš„æ‰¿è½½é¡µé¢ï¼Œå…·ä½“å±•ç¤ºå–å†³äºpage.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>


    

      
        <!-- clipboard -->

  
    <script async type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>



          

            

                

                    

                        

                            
                              <!-- æ–‡ç« å†…å®¹é¡µ urlå½¢å¼ï¼šhttps://yoursite/æ–‡ç« æ ‡é¢˜/ -->
                              <div class="container post-details" id="post-details">
                                <div class="post-content">
                                  <div class="post-title">ç®€æ´çš„æ¶æ„</div>
                                  <div class="post-attach">
                                    <span class="post-pubtime">
                                      <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
                                      2025-10-14 23:59:45
                                    </span>
                                    
                                      <span class="post-tags">
                                        <i class="iconfont icon-tags mr-10" title="Tags"></i>
                                        
                                          <span class="span--tag mr-8">
                                            <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" title="è®¡ç®—æœº"
                                              style="color: var(--post-item-text-color);">
                                              #è®¡ç®—æœº
                                            </a>
                                          </span>
                                          
                                      </span>
                                      
                                  </div>
                                  <div class="markdown-body">
                                    <pre class="mermaid">graph LR
    A[Frameworks & Drivers] --> B[Interface Adapters]
    B --> C[Use Cases]
    C --> D[Entities]

    classDef f fill:#e0f2fe,stroke:#0369a1;
    classDef a fill:#dcfce7,stroke:#16a34a;
    classDef u fill:#fef9c3,stroke:#ca8a04;
    classDef e fill:#fee2e2,stroke:#dc2626;

    class A f
    class B a
    class C u
    class D e</pre>

<p>Clean Architecture(Robert C. Martin) çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡åˆ†å±‚å’Œä¾èµ–è§„åˆ™ï¼Œå®ç°è½¯ä»¶ç³»ç»Ÿçš„é«˜å†…èšã€ä½è€¦åˆï¼Œä»è€Œæå‡å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œå¯æ‰©å±•æ€§ã€‚å…¶å…³é”®åœ¨äºå°†ä¸šåŠ¡é€»è¾‘ä¸å¤–éƒ¨æŠ€æœ¯ç»†èŠ‚ï¼ˆå¦‚æ•°æ®åº“ã€æ¡†æ¶ã€UIã€Web æœåŠ¡ç­‰ï¼‰å½»åº•åˆ†ç¦»ï¼Œç¡®ä¿ç³»ç»Ÿçš„æ ¸å¿ƒâ€”â€”ä¹Ÿå°±æ˜¯ä¸šåŠ¡è§„åˆ™â€”â€”ä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨ç»„ä»¶ã€‚</p>
<p>è¿™ä¸€æ¶æ„å¼ºè°ƒâ€œä¾èµ–å€’ç½®åŸåˆ™â€ï¼šé«˜å±‚æ¨¡å—ï¼ˆå¦‚ç”¨ä¾‹ã€ä¸šåŠ¡é€»è¾‘ï¼‰ä¸åº”ä¾èµ–ä½å±‚æ¨¡å—ï¼ˆå¦‚æ•°æ®åº“ã€ç½‘ç»œï¼‰ï¼Œä¸¤è€…éƒ½åº”ä¾èµ–äºæŠ½è±¡ã€‚æ‰€æœ‰ä¾èµ–å…³ç³»å¿…é¡»æŒ‡å‘ç³»ç»Ÿå†…éƒ¨ï¼Œå³ä»å¤–å±‚ï¼ˆæŠ€æœ¯ç»†èŠ‚å±‚ï¼‰å‘å†…å±‚ï¼ˆä¸šåŠ¡æ ¸å¿ƒå±‚ï¼‰æµåŠ¨ï¼Œè€Œå†…å±‚å¯¹æœ€å¤–å±‚ä¸€æ— æ‰€çŸ¥ã€‚</p>
<p>Clean Architecture é€šå¸¸å°†ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªåŒå¿ƒåœ†å±‚ï¼Œä»å†…åˆ°å¤–ä¾æ¬¡æ˜¯ï¼šEntitiesï¼ˆå®ä½“ï¼Œä»£è¡¨æ ¸å¿ƒä¸šåŠ¡å¯¹è±¡å’Œè§„åˆ™ï¼‰ã€Use Casesï¼ˆç”¨ä¾‹ï¼Œå°è£…å…·ä½“ä¸šåŠ¡é€»è¾‘ï¼‰ã€Interface Adaptersï¼ˆæ¥å£é€‚é…å™¨ï¼Œå¦‚æ§åˆ¶å™¨ã€æ•°æ®è½¬æ¢å™¨ï¼Œç”¨äºè¿æ¥å†…å¤–ï¼‰ã€Frameworks and Driversï¼ˆæ¡†æ¶ä¸é©±åŠ¨ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€Web æ¡†æ¶ã€UI ç­‰ï¼‰ã€‚è¶Šé è¿‘ä¸­å¿ƒï¼Œè¶Šç¨³å®šã€è¶Šé€šç”¨ï¼›è¶Šé å¤–å±‚ï¼Œè¶Šæ˜“å˜ã€è¶Šå…·ä½“ã€‚</p>
<p>é€šè¿‡è¿™ç§ç»“æ„ï¼Œä¸šåŠ¡é€»è¾‘å¯ä»¥ç‹¬ç«‹äºæŠ€æœ¯æ ˆè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œå³ä½¿æ›´æ¢æ•°æ®åº“ã€UI æ¡†æ¶æˆ–éƒ¨ç½²æ–¹å¼ï¼Œä¹Ÿä¸ä¼šå½±å“æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ï¼Œä»è€Œæ˜¾è‘—æå‡ç³»ç»Ÿçš„é•¿æœŸå¯ç»´æŠ¤æ€§å’Œé€‚åº”å˜åŒ–çš„èƒ½åŠ›ã€‚</p>
<h2 id="å®ƒåˆ°åº•æƒ³è§£å†³ä»€ä¹ˆï¼Ÿ"><a href="#å®ƒåˆ°åº•æƒ³è§£å†³ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å®ƒåˆ°åº•æƒ³è§£å†³ä»€ä¹ˆï¼Ÿ"></a>å®ƒåˆ°åº•æƒ³è§£å†³ä»€ä¹ˆï¼Ÿ</h2><p>æƒ³è±¡ä¸€ä¸‹ï¼šä½ å†™äº†ä¸€ä¸ªç”¨æˆ·æ³¨å†ŒåŠŸèƒ½ï¼Œç›´æ¥åœ¨ Flask è·¯ç”±é‡Œè¿æ•°æ®åº“ã€æ ¡éªŒé‚®ç®±ã€æ’å…¥æ•°æ®â€”â€”ä»£ç è·‘å¾—æŒºå¿«ï¼Œä½†å¾ˆå¿«é—®é¢˜æ¥äº†ï¼š</p>
<ul>
<li>æƒ³æ¢æ•°æ®åº“ï¼Ÿå¾—æ”¹ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>æƒ³å†™å•å…ƒæµ‹è¯•ï¼Ÿå¾—å…ˆèµ·ä¸ªæ•°æ®åº“ã€‚</li>
<li>æƒ³åŠ ä¸ªå‘½ä»¤è¡Œå…¥å£ï¼Ÿå¾—æŠŠ Web é€»è¾‘æ‹†å‡ºæ¥ã€‚</li>
<li>ä¸šåŠ¡è§„åˆ™ä¸€å˜ï¼Œæ•´ä¸ªæ–‡ä»¶éƒ½å¾—åŠ¨ã€‚</li>
</ul>
<p>Clean Architecture çš„æ ¸å¿ƒæ€è·¯å¾ˆç®€å•ï¼š<strong>æŠŠâ€œä¸šåŠ¡é€»è¾‘â€å’Œâ€œæŠ€æœ¯ç»†èŠ‚â€åˆ†å¼€ï¼Œè®©å‰è€…ä¸ä¾èµ–åè€…</strong>ã€‚</p>
<p>æ€ä¹ˆåˆ†ï¼Ÿé ä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li><strong>åˆ†å±‚</strong>ï¼šæŠŠä»£ç æŒ‰èŒè´£åˆ†æˆå‡ å±‚ï¼Œè¶Šå¾€é‡Œè¶Šâ€œçº¯ç²¹â€ï¼Œåªå…³å¿ƒä¸šåŠ¡ï¼›è¶Šå¾€å¤–è¶Šâ€œå…·ä½“â€ï¼Œå¤„ç†æ•°æ®åº“ã€HTTPã€æ–‡ä»¶ç­‰ã€‚</li>
<li><strong>ä¾èµ–æ–¹å‘</strong>ï¼šå†…å±‚ä¸çŸ¥é“å¤–å±‚çš„å­˜åœ¨ï¼Œå¤–å±‚å»å®ç°å†…å±‚å®šä¹‰çš„æ¥å£ã€‚</li>
</ol>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ¢æ•°æ®åº“ã€åŠ  APIã€å†™æµ‹è¯•ï¼Œéƒ½åªåŠ¨å¤–å±‚ï¼Œæ ¸å¿ƒé€»è¾‘å‡ ä¹ä¸ç”¨æ”¹ã€‚</p>
<h2 id="ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼šç”¨æˆ·æ³¨å†Œ"><a href="#ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼šç”¨æˆ·æ³¨å†Œ" class="headerlink" title="ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼šç”¨æˆ·æ³¨å†Œ"></a>ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼šç”¨æˆ·æ³¨å†Œ</h2><pre class="mermaid">%%{init: {'theme': 'base', 'themeVariables': { 'fontSize': '14px'}} }%%
flowchart LR
    classDef framework fill:#dbeafe,stroke:#3b82f6,color:#1e40af;
    classDef adapter fill:#dcfce7,stroke:#22c55e,color:#166534;
    classDef usecase fill:#fef3c7,stroke:#f59e0b,color:#92400e;
    classDef entity fill:#fee2e2,stroke:#ef4444,color:#b91c1c;

    subgraph Frameworks["Frameworks & Drivers"]
        F1["ğŸ“„ main.py"]
        F2["ğŸ—ƒï¸ SQLite"]
    end

    subgraph Adapters["Interface Adapters\n(é€‚é…å™¨)"]
        A1["ğŸ”„ SqliteUserRepository"]
        A2["ğŸ”„ InMemoryUserRepository"]
    end

    subgraph UseCases["Use Cases\n(ä¸šåŠ¡ç”¨ä¾‹)"]
        U1["ğŸ§© RegisterUser"]
    end

    subgraph Entities["Entities\n(æ ¸å¿ƒä¸šåŠ¡)"]
        E1["ğŸ“ UserRepository (æ¥å£)"]
        E2["ğŸ‘¤ User (å®ä½“)"]
    end

    %% ä¾èµ–å…³ç³»ï¼šå…¨éƒ¨ä»å¤–å‘å†…ï¼ˆå·¦ â†’ å³ï¼‰
    F1 --> A1
    F2 --> A1
    A1 --> U1
    A2 --> U1
    U1 --> E1
    E1 --> E2

    class F1,F2 framework
    class A1,A2 adapter
    class U1 usecase
    class E1,E2 entity</pre>

<p>æˆ‘ä»¬ç”¨ä¸€ä¸ªæç®€çš„ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ¥æ¼”ç¤ºã€‚é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">user_service/</span><br><span class="line">â”œâ”€â”€ main.py</span><br><span class="line">â”œâ”€â”€ entities/</span><br><span class="line">â”‚   â””â”€â”€ user_repository.py</span><br><span class="line">â”œâ”€â”€ use_cases/</span><br><span class="line">â”‚   â””â”€â”€ register_user.py</span><br><span class="line">â”œâ”€â”€ adapters/</span><br><span class="line">â”‚   â”œâ”€â”€ sqlite_user_repository.py</span><br><span class="line">â”‚   â””â”€â”€ in_memory_user_repository.py</span><br><span class="line">â””â”€â”€ tests/</span><br><span class="line">    â””â”€â”€ test_register_user.py</span><br></pre></td></tr></table></figure>

<h3 id="ç¬¬ä¸€æ­¥ï¼šå®šä¹‰â€œæˆ‘éœ€è¦ä»€ä¹ˆâ€ï¼ˆå†…æ ¸ï¼‰"><a href="#ç¬¬ä¸€æ­¥ï¼šå®šä¹‰â€œæˆ‘éœ€è¦ä»€ä¹ˆâ€ï¼ˆå†…æ ¸ï¼‰" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šå®šä¹‰â€œæˆ‘éœ€è¦ä»€ä¹ˆâ€ï¼ˆå†…æ ¸ï¼‰"></a>ç¬¬ä¸€æ­¥ï¼šå®šä¹‰â€œæˆ‘éœ€è¦ä»€ä¹ˆâ€ï¼ˆå†…æ ¸ï¼‰</h3><p>ä¸šåŠ¡é€»è¾‘è¯´ï¼šâ€œæˆ‘éœ€è¦ä¸€ä¸ªèƒ½å­˜ç”¨æˆ·çš„åœ°æ–¹ã€‚â€<br>ä½†å®ƒä¸å…³å¿ƒæ˜¯å­˜åˆ° SQLiteã€PostgreSQLï¼Œè¿˜æ˜¯å†…å­˜é‡Œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># entities/user_repository.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserRepository</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, name: <span class="built_in">str</span>, email: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br></pre></td></tr></table></figure>

<p>ç„¶åå†™æ³¨å†Œé€»è¾‘ï¼Œåªä¾èµ–è¿™ä¸ªæ¥å£ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># use_cases/register_user.py</span></span><br><span class="line"><span class="keyword">from</span> entities.user_repository <span class="keyword">import</span> UserRepository</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterUser</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, user_repo: UserRepository</span>):</span><br><span class="line">        <span class="variable language_">self</span>.user_repo = user_repo</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, name: <span class="built_in">str</span>, email: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;@&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> email:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;é‚®ç®±æ ¼å¼é”™è¯¯&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.user_repo.save(name, email)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æ³¨å†ŒæˆåŠŸï¼&quot;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šè¿™æ®µä»£ç é‡Œæ²¡æœ‰ä»»ä½• <code>import sqlite3</code>ã€<code>import flask</code>ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•å…·ä½“æŠ€æœ¯ã€‚å®ƒåªåšä¸€ä»¶äº‹ï¼š<strong>æè¿°ä¸šåŠ¡è§„åˆ™</strong>ã€‚</p>
<h3 id="ç¬¬äºŒæ­¥ï¼šå®ç°â€œæ€ä¹ˆå­˜â€ï¼ˆå¤–å±‚ï¼‰"><a href="#ç¬¬äºŒæ­¥ï¼šå®ç°â€œæ€ä¹ˆå­˜â€ï¼ˆå¤–å±‚ï¼‰" class="headerlink" title="ç¬¬äºŒæ­¥ï¼šå®ç°â€œæ€ä¹ˆå­˜â€ï¼ˆå¤–å±‚ï¼‰"></a>ç¬¬äºŒæ­¥ï¼šå®ç°â€œæ€ä¹ˆå­˜â€ï¼ˆå¤–å±‚ï¼‰</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬æä¾›ä¸¤ç§å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adapters/sqlite_user_repository.py</span></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"><span class="keyword">from</span> entities.user_repository <span class="keyword">import</span> UserRepository</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SqliteUserRepository</span>(<span class="title class_ inherited__">UserRepository</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, name: <span class="built_in">str</span>, email: <span class="built_in">str</span></span>):</span><br><span class="line">        conn = sqlite3.connect(<span class="string">&quot;users.db&quot;</span>)</span><br><span class="line">        conn.execute(<span class="string">&quot;INSERT INTO users (name, email) VALUES (?, ?)&quot;</span>, (name, email))</span><br><span class="line">        conn.commit()</span><br><span class="line">        conn.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adapters/in_memory_user_repository.py</span></span><br><span class="line"><span class="keyword">from</span> entities.user_repository <span class="keyword">import</span> UserRepository</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InMemoryUserRepository</span>(<span class="title class_ inherited__">UserRepository</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.users = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, name: <span class="built_in">str</span>, email: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.users.append(&#123;<span class="string">&quot;name&quot;</span>: name, <span class="string">&quot;email&quot;</span>: email&#125;)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªç±»éƒ½å®ç°äº†åŒä¸€ä¸ªæ¥å£ï¼Œä½†ä¸€ä¸ªå†™æ•°æ®åº“ï¼Œä¸€ä¸ªåªå­˜å†…å­˜ã€‚ä¸šåŠ¡é€»è¾‘å®Œå…¨ä¸ç”¨çŸ¥é“åŒºåˆ«ã€‚</p>
<h3 id="ç¬¬ä¸‰æ­¥ï¼šå¯¹è±¡è£…é…"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¯¹è±¡è£…é…" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¯¹è±¡è£…é…"></a>ç¬¬ä¸‰æ­¥ï¼šå¯¹è±¡è£…é…</h3><p>åœ¨ç¨‹åºå…¥å£ï¼Œæˆ‘ä»¬å†³å®šç”¨å“ªä¸ªå®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">from</span> use_cases.register_user <span class="keyword">import</span> RegisterUser</span><br><span class="line"><span class="keyword">from</span> adapters.sqlite_user_repository <span class="keyword">import</span> SqliteUserRepository</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    repo = SqliteUserRepository()</span><br><span class="line">    use_case = RegisterUser(repo)</span><br><span class="line">    <span class="built_in">print</span>(use_case.execute(<span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;xiaoming@example.com&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>å¦‚æœå“ªå¤©æƒ³æ¢æ•°æ®åº“ï¼Œåªéœ€è¦æ”¹è¿™ä¸€è¡Œï¼š<code>repo = PostgresUserRepository()</code>ï¼Œå…¶ä»–åœ°æ–¹ä¸åŠ¨ã€‚</p>
<h3 id="ç¬¬å››æ­¥ï¼šæµ‹è¯•å˜å¾—å¾ˆç®€å•"><a href="#ç¬¬å››æ­¥ï¼šæµ‹è¯•å˜å¾—å¾ˆç®€å•" class="headerlink" title="ç¬¬å››æ­¥ï¼šæµ‹è¯•å˜å¾—å¾ˆç®€å•"></a>ç¬¬å››æ­¥ï¼šæµ‹è¯•å˜å¾—å¾ˆç®€å•</h3><p>å› ä¸ºä¸šåŠ¡é€»è¾‘ä¸ä¾èµ–æ•°æ®åº“ï¼Œæµ‹è¯•å¯ä»¥ç›´æ¥ç”¨å†…å­˜å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># tests/test_register_user.py</span></span><br><span class="line"><span class="keyword">from</span> use_cases.register_user <span class="keyword">import</span> RegisterUser</span><br><span class="line"><span class="keyword">from</span> adapters.in_memory_user_repository <span class="keyword">import</span> InMemoryUserRepository</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_invalid_email</span>():</span><br><span class="line">    repo = InMemoryUserRepository()</span><br><span class="line">    use_case = RegisterUser(repo)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        use_case.execute(<span class="string">&quot;å°æ˜&quot;</span>, <span class="string">&quot;bad-email&quot;</span>)</span><br><span class="line">        <span class="keyword">assert</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="keyword">pass</span>  <span class="comment"># é¢„æœŸè¡Œä¸º</span></span><br></pre></td></tr></table></figure>

<p>ä¸éœ€è¦ mock æ•°æ®åº“è¿æ¥ï¼Œä¹Ÿä¸ç”¨æ¸…ç†æµ‹è¯•æ•°æ®ï¼Œè·‘å¾—å¿«ï¼Œç»“æœç¨³ã€‚</p>
<h2 id="ä¾èµ–å…³ç³»é•¿ä»€ä¹ˆæ ·ï¼Ÿ"><a href="#ä¾èµ–å…³ç³»é•¿ä»€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="ä¾èµ–å…³ç³»é•¿ä»€ä¹ˆæ ·ï¼Ÿ"></a>ä¾èµ–å…³ç³»é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">main.py</span><br><span class="line">   â”‚</span><br><span class="line">   â–¼</span><br><span class="line">use_cases/ â”€â”€â”€â”€ä¾èµ–â”€â”€â”€â–¶ entities/</span><br><span class="line">   â–²                    â–²</span><br><span class="line">   â”‚                    â”‚</span><br><span class="line">adapters/ â”€â”€â”€å®ç°â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<ul>
<li><code>use_cases</code> åªçŸ¥é“ <code>entities</code> é‡Œçš„æ¥å£ï¼›</li>
<li><code>adapters</code> å®ç°è¿™äº›æ¥å£ï¼›</li>
<li><code>main.py</code> è´Ÿè´£æŠŠå®ƒä»¬â€œæ‹¼â€åœ¨ä¸€èµ·ï¼›</li>
<li><strong>å†…å±‚ä»£ç ä»ä¸ import å¤–å±‚</strong>ã€‚</li>
</ul>
<p>è¿™å°±æ˜¯æ‰€è°“çš„â€œä¾èµ–å‘å†…â€â€”â€”ä¸æ˜¯è§„å®šï¼Œè€Œæ˜¯ä¸ºäº†éš”ç¦»å˜åŒ–ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä¸€å¼€å§‹è§‰å¾—è¿™ç§ç»“æ„â€œå¤ªé‡â€ï¼Œä¸€ä¸ªå°åŠŸèƒ½æè¿™ä¹ˆå¤šæ–‡ä»¶ã€‚ä½†åæ¥å‘ç°ï¼š</p>
<ul>
<li>å½“é¡¹ç›®å˜å¤§ï¼Œæ”¹éœ€æ±‚ã€åŠ åŠŸèƒ½æ—¶ï¼Œ<strong>çŸ¥é“å“ªäº›ä»£ç èƒ½åŠ¨ã€å“ªäº›ä¸èƒ½åŠ¨ï¼Œæ¯”ä»€ä¹ˆéƒ½é‡è¦</strong>ï¼›</li>
<li>æµ‹è¯•å†™èµ·æ¥è½»æ¾å¾ˆå¤šï¼Œå°¤å…¶æ˜¯å›å½’æµ‹è¯•ï¼›</li>
<li>å›¢é˜Ÿåä½œæ—¶ï¼Œæœ‰äººæ”¹æ•°æ®åº“ã€æœ‰äººå†™ APIï¼Œåªè¦æ¥å£ä¸å˜ï¼Œäº’ä¸å¹²æ‰°ã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œ<strong>ä¸æ˜¯æ‰€æœ‰é¡¹ç›®éƒ½éœ€è¦è¿™ä¹ˆåˆ†</strong>ã€‚å¦‚æœä½ å†™ä¸ªä¸€æ¬¡æ€§è„šæœ¬ï¼Œç›´æ¥å†™ä¹Ÿæ²¡é—®é¢˜ã€‚ä½†å½“ä½ å¸Œæœ›ä»£ç â€œæ´»å¾—ä¹…ä¸€ç‚¹â€ï¼Œè¿™ç§åˆ†ç¦»ä¼šå¸¦æ¥é•¿æœŸæ”¶ç›Šã€‚</p>
<p>Clean Architecture ä¸æ˜¯é“¶å¼¹ï¼Œä¹Ÿä¸æ˜¯å¿…é¡»éµå®ˆçš„æ•™æ¡ã€‚<br>å®ƒåªæ˜¯æä¾›äº†ä¸€ç§æ€è·¯ï¼š<strong>è®©ä¸šåŠ¡é€»è¾‘ç‹¬ç«‹äºæŠ€æœ¯ç»†èŠ‚</strong>ã€‚<br>ç›®å½•ç»“æ„ã€åˆ†å±‚å‘½åï¼Œéƒ½æ˜¯ä¸ºäº†æœåŠ¡äºè¿™ä¸ªç›®æ ‡ã€‚</p>
<p>å¯ä»¥ä»ä¸€ä¸ªå°åŠŸèƒ½å¼€å§‹å°è¯•â€”â€”æ¯”å¦‚æŠŠæ•°æ®åº“æ“ä½œæŠ½æˆä¸€ä¸ªæ¥å£ï¼Œä¸šåŠ¡é€»è¾‘åªä¾èµ–å®ƒã€‚<br>ä¸ç”¨ä¸€æ­¥åˆ°ä½ï¼Œæ…¢æ…¢ä½“ä¼šå®ƒå¸¦æ¥çš„å¥½å¤„å°±å¥½ã€‚</p>

                                  </div>
                                  
                                    <div class="prev-or-next">
                                      <div class="post-foot-next">
                                        
                                          <a href="/2024/02/22/%E7%90%86%E8%A7%A3%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" target="_self">
                                            <i class="iconfont icon-chevronleft"></i>
                                            <span>
                                              Prev
                                            </span>
                                          </a>
                                          
                                      </div>
                                      <div class="post-attach">
                                        <span class="post-pubtime">
                                          <i class="iconfont icon-updatetime mr-10" title="Update time"></i>
                                          2025-10-14 23:59:45
                                        </span>
                                        
                                          <span class="post-tags">
                                            <i class="iconfont icon-tags mr-10" title="Tags"></i>
                                            
                                              <span class="span--tag mr-8">
                                                <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA/" title="è®¡ç®—æœº"
                                                  style="color: var(--post-item-text-color);">
                                                  #è®¡ç®—æœº
                                                </a>
                                              </span>
                                              
                                          </span>
                                          
                                      </div>
                                      <div class="post-foot-prev">
                                        
                                          <a href="/2025/05/12/%E7%90%86%E8%A7%A3%20Golang%20%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/" target="_self">
                                            <span>
                                              Next
                                            </span>
                                            <i class="iconfont icon-chevronright"></i>
                                          </a>
                                          
                                      </div>
                                    </div>
                                    
                                </div>
                                

                                  
                                    <div class="comments-container">
                                      







                                    </div>
                                    
                              </div>
                              
            
  <div class="footer">
    <div class="social">
      <ul>
        
          <li>
            
                <a title="github" href="">
                  <i class="iconfont icon-github"></i>
                </a>
                
          </li>
          
          <li>
            
              <a title="email" href="mailto:">
                <i class="iconfont icon-envelope"></i>
              </a>
              
          </li>
          
      </ul>
    </div>
    
      
        <div class="footer-more">
          
              Copyright Â© 2025
                
        </div>
        
      
        <div class="footer-more">
          
              powered by owenqing
                
        </div>
        
          
  </div>
        </div>

        <div class="tools-bar">
          <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



            
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer toï¼š<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




              


                
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + %E7%AE%80%E6%B4%81%E7%9A%84%E6%9E%B6%E6%9E%84 + '&url=' + https%3A%2F%2Fowenqing.github.io%2F2024%2F06%2F13%2F%25E7%25AE%2580%25E6%25B4%2581%25E7%259A%2584%25E6%259E%25B6%25E6%259E%2584%2F + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://owenqing.github.io/2024/06/13/%E7%AE%80%E6%B4%81%E7%9A%84%E6%9E%B6%E6%9E%84/" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



        </div>
    </div>
  </body>

</html>
<script src="https://cdn.jsdelivr.net/npm/mermaid@9.3.0/dist/mermaid.min.js"></script>
<script src="/js/mermaid-config.js"></script>